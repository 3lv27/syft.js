{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/sdp/sdp.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/rtcpeerconnection-shim/rtcpeerconnection.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/events.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/logger.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/_constants.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/sockets.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/utils.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/edge/getusermedia.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/edge/getdisplaymedia.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/edge/edge_shim.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/edge/filtericeservers.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/safari/safari_shim.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/common_shim.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/adapter_factory.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/webrtc-adapter/src/js/adapter_core.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/webrtc.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/custom-types/range.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/custom-types/slice.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/node_modules/immutable-tuple/dist/tuple.mjs","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/custom-types/torch-tensor.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/custom-types/torch-size.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/custom-types/plan.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/custom-types/pointer-tensor.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/custom-types/message.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/_helpers.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/serde.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/_errors.js","webpack:////Users/cereallarceny/Dropbox/Development/openmined/code/syft.js/src/index.js","webpack:///./_helpers.js","webpack:///./index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","SDPUtils","Math","random","toString","substr","localCName","generateIdentifier","splitLines","blob","trim","split","map","line","splitSections","part","index","getDescription","sections","getMediaSections","shift","matchPrefix","prefix","filter","indexOf","parseCandidate","parts","candidate","foundation","substring","component","parseInt","protocol","toLowerCase","priority","ip","address","port","type","length","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","writeCandidate","sdp","push","toUpperCase","join","parseIceOptions","parseRtpMap","parsed","payloadType","clockRate","channels","numChannels","writeRtpMap","codec","pt","undefined","preferredPayloadType","parseExtmap","id","direction","uri","writeExtmap","headerExtension","preferredId","parseFmtp","kv","j","writeFmtp","parameters","keys","params","forEach","param","parseRtcpFb","parameter","writeRtcpFb","lines","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","parseSsrcGroup","semantics","ssrcs","getMid","mediaSection","mid","parseFingerprint","algorithm","getDtlsParameters","sessionpart","role","fingerprints","writeDtlsParameters","setupType","fp","getIceParameters","concat","password","writeIceParameters","parseRtpParameters","description","codecs","headerExtensions","fecMechanisms","rtcp","mline","rtpmapline","fmtps","writeRtpDescription","kind","caps","maxptime","extension","parseRtpEncodingParameters","secondarySsrc","encodingParameters","hasRed","hasUlpfec","primarySsrc","flows","apt","encParam","codecPayloadType","rtx","JSON","parse","stringify","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","remoteSsrc","obj","cname","rsize","reducedSize","compound","mux","parseMsid","spec","stream","track","planB","msidParts","parseSctpDescription","maxMessageSize","parseMLine","maxSizeLine","isNaN","sctpPort","fmt","writeSctpDescription","media","sctp","output","generateSessionId","writeSessionBoilerplate","sessId","sessVer","sessUser","version","writeMediaSection","transceiver","iceGatherer","getLocalParameters","dtlsTransport","rtpSender","rtpReceiver","msid","sendEncodingParameters","getDirection","getKind","isRejected","slice","parseOLine","username","sessionId","sessionVersion","netType","addressType","isValidSDP","charAt","dtlsRole","trackId","_initialTrackId","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","findCodecByPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","rCodec","min","lHeaderExtension","rHeaderExtension","isActionAllowedInSignalingState","action","signalingState","offer","setLocalDescription","setRemoteDescription","answer","maybeAddCandidate","iceTransport","alreadyAdded","getRemoteCandidates","find","remoteCandidate","addRemoteCandidate","makeError","e","Error","code","NotSupportedError","InvalidStateError","InvalidAccessError","TypeError","OperationError","window","edgeVersion","addTrackToStreamAndFireEvent","addTrack","dispatchEvent","MediaStreamTrackEvent","fireAddTrack","pc","receiver","streams","trackEvent","Event","setTimeout","_dispatchEvent","RTCPeerConnection","config","this","_eventTarget","document","createDocumentFragment","method","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","_localDescription","_remoteDescription","iceConnectionState","connectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","iceServers","hasTurn","server","urls","url","console","warn","isString","filterIceServers","_iceGatherers","iceCandidatePoolSize","RTCIceGatherer","gatherPolicy","_config","transceivers","_sdpSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","configurable","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","event","_emitGatheringStateChange","getConfiguration","getLocalStreams","getRemoteStreams","_createTransceiver","doNotAdd","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","_maybeFireNegotiationNeeded","RTCRtpSender","addStream","getTracks","clonedStream","clone","idx","clonedTrack","addEventListener","enabled","removeTrack","sender","stop","splice","removeStream","getSenders","getReceivers","_createIceGatherer","sdpMLineIndex","writable","bufferedCandidateEvents","bufferCandidates","end","state","_gather","onlocalcandidate","removeEventListener","evt","sdpMid","cand","serializedCandidate","assign","toJSON","complete","every","RTCIceTransport","onicestatechange","_updateIceConnectionState","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","encodings","receive","Promise","reject","isIceLite","rejected","remoteIceParameters","remoteDtlsParameters","start","_updateSignalingState","resolve","receiverList","iceOptions","remoteMsid","isComplete","cands","setTransport","setRemoteCandidates","MediaStream","default","RTCRtpReceiver","getCapabilities","isNewTrack","nativeTrack","removeTrackFromStreamAndFireEvent","sid","item","close","newState","states","closed","checking","connected","completed","disconnected","failed","new","connecting","createOffer","numAudioTracks","numVideoTracks","offerOptions","arguments","mandatory","optional","offerToReceiveAudio","offerToReceiveVideo","remoteCodec","hdrExt","rHdrExt","getLocalCandidates","desc","RTCSessionDescription","createAnswer","mediaSectionsInOffer","localTrack","getAudioTracks","getVideoTracks","addIceCandidate","candidateString","getStats","selector","MediaStreamTrack","senderOrReceiver","promises","all","then","allStats","results","Map","stats","stat","set","ortcObjectName","nativeGetstats","apply","nativeStats","mapStats","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","methods","nativeMethod","args","error","EventObserver","constructor","observers","subscribe","func","unsubscribe","eventType","broadcast","data","observer","Logger","verbose","log","message","Date","now","SOCKET_STATUS","SOCKET_PING","GET_PLANS","WEBRTC_JOIN_ROOM","WEBRTC_NEW_PEER","WEBRTC_INTERNAL_MESSAGE","WEBRTC_PEER_LEFT","Sockets","opts","logger","instanceId","onOpen","onClose","onMessage","socket","WebSocket","keepAlive","readyState","OPEN","timerId","cancelKeepAlive","clearTimeout","onopen","currentTarget","onclose","timerID","onmessage","logDisabled_","deprecationWarnings_","extractVersion","uastring","expr","pos","match","wrapPeerConnectionEvent","eventNameToWrap","wrapper","proto","nativeAddEventListener","nativeEventName","cb","wrappedCallback","modifiedEvent","_eventMap","nativeRemoveEventListener","unwrappedCb","disableLog","bool","disableWarnings","deprecated","oldMethod","newMethod","detectBrowser","navigator","result","browser","mozGetUserMedia","userAgent","webkitGetUserMedia","isSecureContext","webkitRTCPeerConnection","mediaDevices","supportsUnifiedPlan","RTCRtpTransceiver","isObject","val","compactObject","reduce","accumulator","isObj","isEmptyObject","filterStats","outbound","streamStatsType","filteredResult","trackStats","trackIdentifier","trackStat","walkStats","base","resultSet","has","endsWith","shimGetUserMedia","browserDetails","constraintsToChrome_","cc","ideal","exact","max","oldname_","oc","mix","advanced","shimConstraints_","constraints","audio","remap","a","b","video","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","enumerateDevices","devices","dev","some","label","includes","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","constraint","constraintName","getUserMedia","onSuccess","onError","origGetUserMedia","cs","DOMException","shimGetDisplayMedia","getSourceId","getDisplayMedia","sourceId","widthSpecified","width","heightSpecified","height","frameRateSpecified","frameRate","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","maxHeight","shimMediaStream","webkitMediaStream","shimOnTrack","_ontrack","f","origSetRemoteDescription","_ontrackpoly","te","shimGetSendersWithDtmf","shimSenderWithDtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","origRemoveTrack","origAddStream","origRemoveStream","origGetSenders","senders","shimGetStats","origGetStats","onSucc","onErr","fixChromeStats_","response","standardReport","report","standardStats","timestamp","names","makeMapStats","successCallbackWrapper_","shimSenderReceiverGetStats","origGetReceivers","receivers","srcElement","err","shimAddTrackRemoveTrackWithNative","_shimmedLocalStreams","streamId","existingSenders","newSenders","newSender","shimAddTrackRemoveTrack","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","replaceInternalStreamId","internalId","externalStream","internalStream","replace","RegExp","replaceExternalStreamId","alreadyExists","oldStream","methodObj","origSetLocalDescription","origLocalDescription","getOwnPropertyDescriptor","streamid","shimPeerConnection","RTCIceCandidate","nativeAddIceCandidate","fixNegotiationNeeded","target","catch","origMSTEnabled","ev","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","validTurn","startsWith","shimReplaceTrack","replaceTrack","setTrack","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","preferredMediaSource","mediaSource","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","nativeGetStats","shimSenderGetStats","shimReceiverGetStats","shimRemoveStream","shimRTCDataChannel","DataChannel","RTCDataChannel","shimAddTransceiver","origAddTransceiver","addTransceiver","setParametersPromises","initParameters","shouldPerformCheck","sendEncodings","encodingParam","test","rid","parseFloat","scaleResolutionDownBy","RangeError","maxFramerate","getParameters","setParameters","shimCreateOffer","origCreateOffer","finally","shimCreateAnswer","origCreateAnswer","shimLocalStreamsAPI","_localStreams","_addTrack","tracks","shimRemoteStreamsAPI","_remoteStreams","_onaddstream","_onaddstreampoly","shimCallbacksAPI","successCallback","failureCallback","options","promise","withCallback","_getUserMedia","shimConstraints","errcb","shimRTCIceServerUrls","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","generateCertificate","shimTrackEventTransceiver","shimCreateOfferLegacy","audioTransceiver","getTransceivers","setDirection","videoTransceiver","shimRTCIceCandidate","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","shimMaxMessageSize","_sctp","sctpInDescription","mLine","getRemoteFirefoxVersion","getCanSendMaxMessageSize","remoteIsFirefox","canSendMaxMessageSize","getMaxMessageSize","sdpSemantics","isFirefox","canSendMMS","remoteMMS","Number","POSITIVE_INFINITY","shimSendThrowTypeError","wrapDcSend","dc","origDataChannelSend","size","byteLength","origCreateDataChannel","createDataChannel","dataChannel","channel","shimConnectionState","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","newEvent","removeAllowExtmapMixed","nativeSRD","shimChrome","shimFirefox","shimEdge","shimSafari","logging","adapter","commonShim","browserShim","adapterFactory","WebRTCClient","peerConfig","peerOptions","peers","scopeId","_forEachPeer","peer","removePeer","sendMessage","to","msg","createConnection","candidateCache","initConnection","connection","owner","addDataChannelListeners","sdpType","sendInternalMessage","localDescription","receiveNewPeer","_handleError","receiveInternalMessage","remoteCandidateReceived","remoteOfferReceived","remoteAnswerReceived","self","callback","includeMe","Range","step","Slice","useSymbol","for","brand","globalKey","def","freeze","isObjRef","UniversalWeakMap","_weakMap","_strongMap","_getMap","canCreate","WeakMap","root","Array","lookup","array","node","len","lookupArray","tuple","arguments$1","argc","isTuple","that","toArray","fn","mustConvertThisToArray","iterator","forEachArrayMethod","isArray","TorchTensor","bin","chain","gradChain","tags","TorchSize","Plan","operations","isBuilt","PointerTensor","idAtLocation","locationId","pointToAttr","shape","garbageCollectData","Message","contents","DETAIL_REPLACERS","runReplacers","replacers","detail","DETAILERS","Set","Tuple","detailer","NO_DETAILER","syft","protocolId","participants","plans","createSocketConnection","rtc","createWebRTCClient","getPlans","onSocketStatus","Socket","disconnectFromGrid","plan","user","DtlsSrtpKeyAgreement","RtpDataChannels","connectToParticipants","disconnectFromParticipants","sendToParticipants","getQueryVariable","variable","vars","location","search","pair","decodeURIComponent","gridInstance","getElementById","connectButton","disconnectButton","appContainer","textarea","submitButton","style","display","onclick","startSyft","mySyft","async","text","innerHTML","writeIdentityToDOM","history","pushState","links","link","writeLinksToDOM","origin","pathname"],"mappings":"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","file":"index.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\nSDPUtils.parseSsrcGroup = function(line) {\n  var parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(function(ssrc) {\n      return parseInt(ssrc, 10);\n    })\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(parts) {\n      return parts.attribute === 'cname';\n    });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(function(line) {\n      var parts = line.substr(17).split(' ');\n      return parts.map(function(part) {\n        return parseInt(part, 10);\n      });\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10)\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  // Gets the first SSRC. Note tha with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(obj) {\n      return obj.attribute === 'cname';\n    })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrіbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(msidParts) {\n      return msidParts.attribute === 'msid';\n    });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  var mline = SDPUtils.parseMLine(mediaSection);\n  var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  var maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substr(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize: maxMessageSize\n    };\n  }\n  var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    var parts = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:')[0]\n      .substr(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize: maxMessageSize\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  var output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n'\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n'\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  var user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n    transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n    transceiver.dtlsTransport.getLocalParameters(),\n    type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5]\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  var lines = SDPUtils.splitLines(blob);\n  for (var i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction fixStatsType(stat) {\n  return {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  }[stat.type] || stat.type;\n}\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    var trackId = transceiver.rtpSender._initialTrackId ||\n        transceiver.rtpSender.track.id;\n    transceiver.rtpSender._initialTrackId = trackId;\n    // spec.\n    var msid = 'msid:' + (stream ? stream.id : '-') + ' ' +\n        trackId + '\\r\\n';\n    sdp += 'a=' + msid;\n    // for Chrome. Legacy should no longer be required.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n\n    // RTX\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all fieldѕ are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  // legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\n  e.code = {\n    NotSupportedError: 9,\n    InvalidStateError: 11,\n    InvalidAccessError: 15,\n    TypeError: undefined,\n    OperationError: undefined\n  }[name];\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  // https://w3c.github.io/mediacapture-main/#mediastream\n  // Helper function to add the track to the stream and\n  // dispatch the event ourselves.\n  function addTrackToStreamAndFireEvent(track, stream) {\n    stream.addTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\n        {track: track}));\n  }\n\n  function removeTrackFromStreamAndFireEvent(track, stream) {\n    stream.removeTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\n        {track: track}));\n  }\n\n  function fireAddTrack(pc, track, receiver, streams) {\n    var trackEvent = new Event('track');\n    trackEvent.track = track;\n    trackEvent.receiver = receiver;\n    trackEvent.transceiver = {receiver: receiver};\n    trackEvent.streams = streams;\n    window.setTimeout(function() {\n      pc._dispatchEvent('track', trackEvent);\n    });\n  }\n\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this._localDescription = null;\n    this._remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.connectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers.push(new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        }));\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  Object.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\n    configurable: true,\n    get: function() {\n      return this._localDescription;\n    }\n  });\n  Object.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\n    configurable: true,\n    get: function() {\n      return this._remoteDescription;\n    }\n  });\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (which is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    if (!doNotAdd) {\n      this.transceivers.push(transceiver);\n    }\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call removeTrack on a closed peerconnection.');\n    }\n\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\n        pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var bufferedCandidateEvents =\n      this.transceivers[sdpMLineIndex].bufferedCandidateEvents;\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // ѕdpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete‥\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        // also the usernameFragment. TODO: update SDP to take both variants.\n        cand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\n\n        var serializedCandidate = SDPUtils.writeCandidate(cand);\n        event.candidate = Object.assign(event.candidate,\n            SDPUtils.parseCandidate(serializedCandidate));\n\n        event.candidate.candidate = serializedCandidate;\n        event.candidate.toJSON = function() {\n          return {\n            candidate: event.candidate.candidate,\n            sdpMid: event.candidate.sdpMid,\n            sdpMLineIndex: event.candidate.sdpMLineIndex,\n            usernameFragment: event.candidate.usernameFragment\n          };\n        };\n      }\n\n      // update local description.\n      var sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc._localDescription.sdp =\n          SDPUtils.getDescription(pc._localDescription.sdp) +\n          sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      bufferedCandidateEvents.forEach(function(e) {\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateIceConnectionState();\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itself.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      } else {\n        params.encodings = [{}];\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc._remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.rejected) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    pc._localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-local-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    pc.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    pc.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      pc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      pc.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\n          protocol === 'UDP/DTLS/SCTP'))) {\n        // TODO: this is dangerous in the case where a non-rejected m-line\n        //     becomes rejected.\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          kind: kind,\n          protocol: protocol,\n          rejected: true\n        };\n        return;\n      }\n\n      if (!rejected && pc.transceivers[sdpMLineIndex] &&\n          pc.transceivers[sdpMLineIndex].rejected) {\n        // recycle a rejected transceiver.\n        pc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        // If the offer contained RTX but the answer did not,\n        // remove RTX from sendEncodingParameters.\n        var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n        var hasRtx = commonCapabilities.codecs.filter(function(c) {\n          return c.name.toLowerCase() === 'rtx';\n        }).length;\n        if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n          delete transceiver.sendEncodingParameters[0].rtx;\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (pc._dtlsRole === undefined) {\n      pc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    pc._remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-remote-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation) {\n        pc.needNegotiation = false;\n        var event = new Event('negotiationneeded');\n        pc._dispatchEvent('negotiationneeded', event);\n      }\n    }, 0);\n  };\n\n  // Update the ice connection state.\n  RTCPeerConnection.prototype._updateIceConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n      }\n    });\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.checking > 0) {\n      newState = 'checking';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    } else if (states.completed > 0) {\n      newState = 'completed';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && transceiver.dtlsTransport &&\n          !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n        states[transceiver.dtlsTransport.state]++;\n      }\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.connectionState) {\n      this.connectionState = newState;\n      var event = new Event('connectionstatechange');\n      this._dispatchEvent('connectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    pc.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        pc._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        pc._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = transceiver.mid || SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n\n        // for subsequent offers, we might have to re-use the payload\n        // type of the last offer.\n        if (transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.codecs) {\n          transceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {\n            if (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\n                codec.clockRate === remoteCodec.clockRate) {\n              codec.preferredPayloadType = remoteCodec.payloadType;\n            }\n          });\n        }\n      });\n      localCapabilities.headerExtensions.forEach(function(hdrExt) {\n        var remoteExtensions = transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.headerExtensions || [];\n        remoteExtensions.forEach(function(rHdrExt) {\n          if (hdrExt.uri === rHdrExt.uri) {\n            hdrExt.id = rHdrExt.id;\n          }\n        });\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (pc._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    if (!(pc.signalingState === 'have-remote-offer' ||\n        pc.signalingState === 'have-local-pranswer')) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer in signalingState ' + pc.signalingState));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    if (pc.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    var mediaSectionsInOffer = SDPUtils.getMediaSections(\n        pc._remoteDescription.sdp).length;\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.rejected) {\n        if (transceiver.kind === 'application') {\n          if (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\n            sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\n          } else {\n            sdp += 'm=application 0 ' + transceiver.protocol +\n                ' webrtc-datachannel\\r\\n';\n          }\n        } else if (transceiver.kind === 'audio') {\n          sdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\n              'a=rtpmap:0 PCMU/8000\\r\\n';\n        } else if (transceiver.kind === 'video') {\n          sdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\n              'a=rtpmap:120 VP8/90000\\r\\n';\n        }\n        sdp += 'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=inactive\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var pc = this;\n    var sections;\n    if (candidate && !(candidate.sdpMLineIndex !== undefined ||\n        candidate.sdpMid)) {\n      return Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\n    }\n\n    // TODO: needs to go into ops queue.\n    return new Promise(function(resolve, reject) {\n      if (!pc._remoteDescription) {\n        return reject(makeError('InvalidStateError',\n            'Can not add ICE candidate without a remote description'));\n      } else if (!candidate || candidate.candidate === '') {\n        for (var j = 0; j < pc.transceivers.length; j++) {\n          if (pc.transceivers[j].rejected) {\n            continue;\n          }\n          pc.transceivers[j].iceTransport.addRemoteCandidate({});\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[j] += 'a=end-of-candidates\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n          if (pc.usingBundle) {\n            break;\n          }\n        }\n      } else {\n        var sdpMLineIndex = candidate.sdpMLineIndex;\n        if (candidate.sdpMid) {\n          for (var i = 0; i < pc.transceivers.length; i++) {\n            if (pc.transceivers[i].mid === candidate.sdpMid) {\n              sdpMLineIndex = i;\n              break;\n            }\n          }\n        }\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        if (transceiver) {\n          if (transceiver.rejected) {\n            return resolve();\n          }\n          var cand = Object.keys(candidate.candidate).length > 0 ?\n              SDPUtils.parseCandidate(candidate.candidate) : {};\n          // Ignore Chrome's invalid candidates since Edge does not like them.\n          if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n            return resolve();\n          }\n          // Ignore RTCP candidates, we assume RTCP-MUX.\n          if (cand.component && cand.component !== 1) {\n            return resolve();\n          }\n          // when using bundle, avoid adding candidates to the wrong\n          // ice transport. And avoid adding candidates added in the SDP.\n          if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n              transceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\n            if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n              return reject(makeError('OperationError',\n                  'Can not add ICE candidate'));\n            }\n          }\n\n          // update the remoteDescription.\n          var candidateString = candidate.candidate.trim();\n          if (candidateString.indexOf('a=') === 0) {\n            candidateString = candidateString.substr(2);\n          }\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[sdpMLineIndex] += 'a=' +\n              (cand.type ? candidateString : 'end-of-candidates')\n              + '\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n        } else {\n          return reject(makeError('OperationError',\n              'Can not add ICE candidate'));\n        }\n      }\n      resolve();\n    });\n  };\n\n  RTCPeerConnection.prototype.getStats = function(selector) {\n    if (selector && selector instanceof window.MediaStreamTrack) {\n      var senderOrReceiver = null;\n      this.transceivers.forEach(function(transceiver) {\n        if (transceiver.rtpSender &&\n            transceiver.rtpSender.track === selector) {\n          senderOrReceiver = transceiver.rtpSender;\n        } else if (transceiver.rtpReceiver &&\n            transceiver.rtpReceiver.track === selector) {\n          senderOrReceiver = transceiver.rtpReceiver;\n        }\n      });\n      if (!senderOrReceiver) {\n        throw makeError('InvalidAccessError', 'Invalid selector.');\n      }\n      return senderOrReceiver.getStats();\n    }\n\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    return Promise.all(promises).then(function(allStats) {\n      var results = new Map();\n      allStats.forEach(function(stats) {\n        stats.forEach(function(stat) {\n          results.set(stat.id, stat);\n        });\n      });\n      return results;\n    });\n  };\n\n  // fix low-level stat names and return Map instead of object.\n  var ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',\n    'RTCIceTransport', 'RTCDtlsTransport'];\n  ortcObjects.forEach(function(ortcObjectName) {\n    var obj = window[ortcObjectName];\n    if (obj && obj.prototype && obj.prototype.getStats) {\n      var nativeGetstats = obj.prototype.getStats;\n      obj.prototype.getStats = function() {\n        return nativeGetstats.apply(this)\n        .then(function(nativeStats) {\n          var mapStats = new Map();\n          Object.keys(nativeStats).forEach(function(id) {\n            nativeStats[id].type = fixStatsType(nativeStats[id]);\n            mapStats.set(id, nativeStats[id]);\n          });\n          return mapStats;\n        });\n      };\n    }\n  });\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n","export default class EventObserver {\n  constructor() {\n    this.observers = [];\n  }\n\n  subscribe(type, func) {\n    this.observers.push({ type, func });\n  }\n\n  unsubscribe(eventType) {\n    this.observers = this.observers.filter(({ type }) => eventType !== type);\n  }\n\n  broadcast(eventType, data) {\n    this.observers.forEach(observer => {\n      if (eventType === observer.type) {\n        return observer.func(data);\n      }\n    });\n  }\n}\n","// A simple logging function\nexport default class Logger {\n  constructor(verbose) {\n    this.verbose = verbose;\n  }\n\n  log(message, data) {\n    // Only log if verbose is turned on\n    if (this.verbose) {\n      const output = `${Date.now()}: syft.js - ${message}`;\n\n      // Have the passed additional data?\n      if (data) {\n        console.log(output, data);\n      } else {\n        console.log(output);\n      }\n    }\n  }\n}\n","// Sockets\nexport const SOCKET_STATUS = 'socket-status';\nexport const SOCKET_PING = 'socket-ping';\n\n// Grid\nexport const GET_PLANS = 'get-plans';\n\n// Operations\n// export const GET_TENSORS = 'get-tensors';\n// export const GET_TENSOR = 'get-tensor';\n// export const RUN_OPERATION = 'run-operation';\n// export const TENSOR_ADDED = 'add-tensor';\n// export const TENSOR_REMOVED = 'remove-tensor';\n\n// WebRTC\nexport const WEBRTC_JOIN_ROOM = 'webrtc: join-room';\nexport const WEBRTC_NEW_PEER = 'webrtc: new-peer';\nexport const WEBRTC_INTERNAL_MESSAGE = 'webrtc: internal-message';\nexport const WEBRTC_PEER_LEFT = 'webrtc: peer-left';\n","import { SOCKET_PING } from './_constants';\n\nexport default class Sockets {\n  constructor(opts) {\n    const { url, logger, instanceId, onOpen, onClose, onMessage } = opts;\n\n    const socket = new WebSocket(url);\n\n    const keepAlive = () => {\n      const timeout = 20000;\n\n      if (this.socket.readyState == this.socket.OPEN) {\n        this.send(SOCKET_PING);\n      }\n\n      this.timerId = setTimeout(keepAlive, timeout);\n    };\n\n    const cancelKeepAlive = () => {\n      if (this.timerId) {\n        clearTimeout(this.timerId);\n      }\n    };\n\n    socket.onopen = event => {\n      this.logger.log(\n        `Opening socket connection at ${event.currentTarget.url}`,\n        event\n      );\n\n      keepAlive();\n\n      if (onOpen) onOpen(event);\n    };\n\n    socket.onclose = event => {\n      this.logger.log(\n        `Closing socket connection at ${event.currentTarget.url}`,\n        event\n      );\n\n      cancelKeepAlive();\n\n      if (onClose) onClose(event);\n    };\n\n    this.url = url;\n    this.logger = logger;\n    this.instanceId = instanceId;\n    this.socket = socket;\n    this.onMessage = onMessage;\n    this.timerID = 0;\n  }\n\n  send(type, data = {}) {\n    return new Promise((resolve, reject) => {\n      data.instanceId = this.instanceId;\n\n      const message = { type, data };\n\n      this.logger.log('Sending message', message);\n\n      this.socket.send(JSON.stringify(message));\n\n      this.socket.onmessage = event => {\n        const data = JSON.parse(event.data);\n\n        this.logger.log('Receiving message', data);\n\n        resolve(this.onMessage(data));\n      };\n\n      this.socket.onerror = event => {\n        this.logger.log('We have a socket error!', event);\n\n        reject(event);\n      };\n    });\n  }\n\n  stop() {\n    this.socket.close();\n  }\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        cb(modifiedEvent);\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n      'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  const {navigator} = window;\n\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent,\n        /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection &&\n       !window.RTCIceGatherer)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent,\n        /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (navigator.mediaDevices &&\n      navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n    result.browser = 'edge';\n    result.version = extractVersion(navigator.userAgent,\n        /Edge\\/(\\d+).(\\d+)$/, 2);\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent,\n        /AppleWebKit\\/(\\d+)\\./, 1);\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const browserDetails = utils.detectBrowser(window);\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(devices => {\n            devices = devices.filter(d => d.kind === 'videoinput');\n            let dev = devices.find(d => matches.some(match =>\n              d.label.toLowerCase().includes(match)));\n            if (!dev && devices.length && matches.includes('back')) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nexport function shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n        'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      return getSourceId(constraints)\n        .then(sourceId => {\n          const widthSpecified = constraints.video && constraints.video.width;\n          const heightSpecified = constraints.video &&\n            constraints.video.height;\n          const frameRateSpecified = constraints.video &&\n            constraints.video.frameRate;\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: frameRateSpecified || 3\n            }\n          };\n          if (widthSpecified) {\n            constraints.video.mandatory.maxWidth = widthSpecified;\n          }\n          if (heightSpecified) {\n            constraints.video.mandatory.maxHeight = heightSpecified;\n          }\n          return window.navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n}\n","\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 ||\n        typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    const fixChromeStats_ = function(response) {\n      const standardReport = {};\n      const reports = response.result();\n      reports.forEach(report => {\n        const standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(name => {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    const makeMapStats = function(stats) {\n      return new Map(Object.keys(stats).map(key => [key, stats[key]]));\n    };\n\n    if (arguments.length >= 2) {\n      const successCallbackWrapper_ = function(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_,\n        selector]);\n    }\n\n    // promise-support\n    return new Promise((resolve, reject) => {\n      origGetStats.apply(this, [\n        function(response) {\n          resolve(makeMapStats(fixChromeStats_(response)));\n        }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n      .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n          this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n          externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n          internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n      .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n      window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n      'localDescription', {\n        get() {\n          const description = origLocalDescription.get.apply(this);\n          if (description.type === '') {\n            return description;\n          }\n          return replaceInternalStreamId(this, description);\n        }\n      });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions. Native support planned for Chrome M77.\n      if (browserDetails.version < 78 &&\n        arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\nexport function fixNegotiationNeeded(window) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (pc.signalingState !== 'stable') {\n      return;\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  const shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(e => Promise.reject(shimError_(e)));\n  };\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window) {\n  if (!('getDisplayMedia' in window.navigator)) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    window.navigator.getDisplayMedia.bind(window.navigator);\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nimport {filterIceServers} from './filtericeservers';\nimport shimRTCPeerConnection from 'rtcpeerconnection-shim';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (window.RTCIceGatherer) {\n    if (!window.RTCIceCandidate) {\n      window.RTCIceCandidate = function RTCIceCandidate(args) {\n        return args;\n      };\n    }\n    if (!window.RTCSessionDescription) {\n      window.RTCSessionDescription = function RTCSessionDescription(args) {\n        return args;\n      };\n    }\n    // this adds an additional event listener to MediaStrackTrack that signals\n    // when a tracks enabled property was changed. Workaround for a bug in\n    // addStream, see below. No longer required in 15025+\n    if (browserDetails.version < 15025) {\n      const origMSTEnabled = Object.getOwnPropertyDescriptor(\n          window.MediaStreamTrack.prototype, 'enabled');\n      Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n        set(value) {\n          origMSTEnabled.set.call(this, value);\n          const ev = new Event('enabled');\n          ev.enabled = value;\n          this.dispatchEvent(ev);\n        }\n      });\n    }\n  }\n\n  // ORTC defines the DTMF sender a bit different.\n  // https://github.com/w3c/ortc/issues/714\n  if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = new window.RTCDtmfSender(this);\n          } else if (this.track.kind === 'video') {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n  // Edge currently only implements the RTCDtmfSender, not the\n  // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\n  if (window.RTCDtmfSender && !window.RTCDTMFSender) {\n    window.RTCDTMFSender = window.RTCDtmfSender;\n  }\n\n  const RTCPeerConnectionShim = shimRTCPeerConnection(window,\n      browserDetails.version);\n  window.RTCPeerConnection = function RTCPeerConnection(config) {\n    if (config && config.iceServers) {\n      config.iceServers = filterIceServers(config.iceServers,\n        browserDetails.version);\n      utils.log('ICE servers after filtering:', config.iceServers);\n    }\n    return new RTCPeerConnectionShim(config);\n  };\n  window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\n}\n\nexport function shimReplaceTrack(window) {\n  // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n  if (window.RTCRtpSender &&\n      !('replaceTrack' in window.RTCRtpSender.prototype)) {\n    window.RTCRtpSender.prototype.replaceTrack =\n        window.RTCRtpSender.prototype.setTrack;\n  }\n}\n","/*\n *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nexport function filterIceServers(iceServers, edgeVersion) {\n  let hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(server => {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n      }\n      const isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(url => {\n        // filter STUN unconditionally.\n        if (url.indexOf('stun:') === 0) {\n          return false;\n        }\n\n        const validTurn = url.startsWith('turn') &&\n            !url.startsWith('turn:[') &&\n            url.includes('transport=udp');\n        if (validTurn && !hasTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return validTurn && !hasTurn;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window) {\n  const browserDetails = utils.detectBrowser(window);\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  // as well as ignoring {sdpMid, candidate: \"\"}\n  if (browserDetails.version < 68) {\n    const nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      if (arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n        Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        const initParameters = arguments[1];\n        const shouldPerformCheck = initParameters &&\n                                  'sendEncodings' in initParameters;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          initParameters.sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params)) {\n            params.encodings = initParameters.sendEncodings;\n            this.setParametersPromises.push(\n              sender.setParameters(params)\n              .catch(() => {})\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateOffer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateAnswer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track) {\n        const stream = arguments[1];\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (!this._localStreams.includes(stream)) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n      .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in window.RTCPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio');\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substr(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      const augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function toJSON() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substr(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n            this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n            this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeAllowExtmapMixed(window) {\n  /* remove a=extmap-allow-mixed for Chrome < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      desc.sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n  // Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as edgeShim from './edge/edge_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimEdge: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n      chromeShim.shimGetStats(window);\n      chromeShim.shimSenderReceiverGetStats(window);\n      chromeShim.fixNegotiationNeeded(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n      firefoxShim.shimSenderGetStats(window);\n      firefoxShim.shimReceiverGetStats(window);\n      firefoxShim.shimRTCDataChannel(window);\n      firefoxShim.shimAddTransceiver(window);\n      firefoxShim.shimCreateOffer(window);\n      firefoxShim.shimCreateAnswer(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimGetDisplayMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCreateOfferLegacy(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter = adapterFactory({window});\nexport default adapter;\n","// NOTE: Adding async/await in this file requires regenerator-runtime/runtime which adds an unnecessary 2kb on the minified bundled - no thanks!\nimport 'webrtc-adapter';\n\nimport {\n  WEBRTC_JOIN_ROOM,\n  WEBRTC_INTERNAL_MESSAGE,\n  WEBRTC_PEER_LEFT\n} from './_constants';\n\nexport default class WebRTCClient {\n  constructor(opts) {\n    const { peerConfig, peerOptions, logger, socket } = opts;\n\n    this.peerConfig = peerConfig;\n    this.peerOptions = peerOptions;\n    this.logger = logger;\n    this.socket = socket;\n\n    this.peers = {};\n\n    this.instanceId = null;\n    this.scopeId = null;\n  }\n\n  // The main start command for WebRTC\n  // This will store your id (instanceId) and room (scopeId) and immediately join that room\n  start(instanceId, scopeId) {\n    this.logger.log(`WebRTC: Joining room ${scopeId}`);\n\n    this.instanceId = instanceId;\n    this.scopeId = scopeId;\n\n    // Immediately send a request to enter the room\n    this.socket.send(WEBRTC_JOIN_ROOM, { instanceId, scopeId });\n  }\n\n  // The main stop command for WebRTC\n  // This goes through all the peers and closes the connection from each one\n  stop() {\n    this.logger.log('WebRTC: Disconnecting from peers');\n\n    this.socket.send(WEBRTC_PEER_LEFT, {\n      instanceId: this.instanceId,\n      scopeId: this.scopeId\n    });\n\n    this._forEachPeer((peer, instanceId) => {\n      if (peer.channel) {\n        this.removePeer(instanceId);\n      }\n    }, true);\n  }\n\n  // Remove a peer when the signaling server has notified us they've left or when stop() is run\n  removePeer(instanceId) {\n    this.logger.log(`WebRTC: Closing connection to ${instanceId}`);\n\n    try {\n      this.peers[instanceId].channel.close();\n    } catch (e) {\n      this.logger.log('WebRTC: Error removing peer', e);\n    }\n\n    delete this.peers[instanceId];\n  }\n\n  // Given a message, this function allows you to \"broadcast\" a message to all peers\n  // Alternatively, you may send a targeted message to one specific peer (specified by the \"to\" param)\n  sendMessage(message, to) {\n    this.logger.log('WebRTC: Sending message', message);\n\n    const send = (channel, msg) => {\n      try {\n        channel.send(msg);\n      } catch (e) {\n        this.logger.log('WebRTC: Error sending message', e);\n      }\n    };\n\n    // If \"to\" is specified, send to that users\n    if (\n      to &&\n      to !== this.instanceId &&\n      this.peers[to] &&\n      this.peers[to].channel\n    ) {\n      send(this.peers[to].channel, message);\n    }\n\n    // Otherwise, send to each user specified\n    else {\n      this._forEachPeer(peer => {\n        if (peer.channel) {\n          send(peer.channel, message);\n        }\n      });\n    }\n  }\n\n  // Create an RTCPeerConnection on our end for each offer or answer we receive\n  createConnection(instanceId) {\n    this.logger.log('WebRTC: Creating connection');\n\n    // Create a new peer in the list with a blank candidate cache (to be populated by ICE candidates we receive)\n    this.peers[instanceId] = {\n      candidateCache: []\n    };\n\n    // Create and initialize the new connection, then add that connection to the peers list\n    const pc = new RTCPeerConnection(this.peerConfig, this.peerOptions);\n    this.initConnection(pc, instanceId, 'answer');\n    this.peers[instanceId].connection = pc;\n\n    // When this peer connection receives a data channel\n    pc.ondatachannel = e => {\n      this.logger.log('WebRTC: Calling ondatachannel');\n\n      this.peers[instanceId].channel = e.channel;\n      this.peers[instanceId].channel.owner = instanceId;\n\n      // Set up all our event listeners for this channel so we can hook into them\n      this.addDataChannelListeners(this.peers[instanceId].channel);\n    };\n  }\n\n  // Initialize a given RTCPeerConnection (\"pc\"), for a peer (\"instanceId\"), with an sdpType of \"offer\" or \"answer\"\n  initConnection(pc, instanceId, sdpType) {\n    this.logger.log('WebRTC: Initializing connection');\n\n    // How an RTCPeerConnection handle new ICE candidates or offer/answer messages...\n    pc.onicecandidate = event => {\n      // If we have an ICE candidate to handle\n      if (event.candidate) {\n        this.logger.log('WebRTC: Saving new ICE candidate');\n\n        // Save it to the list for further sending\n        this.peers[instanceId].candidateCache.push(event.candidate);\n      }\n\n      // When the candidate discovery is completed, the handler will be called again, but without the candidate\n      else {\n        this.logger.log(`WebRTC: Sending ${sdpType} and stored ICE candidates`);\n\n        // In this case, we first send the first SDP offer or SDP answer (depending on the sdpType)...\n        this.sendInternalMessage(sdpType, pc.localDescription, instanceId);\n\n        // ... then we send all stored ICE candidates\n        for (let i = 0; i < this.peers[instanceId].candidateCache.length; i++) {\n          this.sendInternalMessage(\n            'candidate',\n            this.peers[instanceId].candidateCache[i],\n            instanceId\n          );\n        }\n      }\n    };\n  }\n\n  // When we receive a new peer's instanceId from grid.js...\n  receiveNewPeer({ instanceId }) {\n    this.logger.log('WebRTC: Adding new peer');\n\n    // Create a new peer in the list with a blank candidate cache (to be populated by ICE candidates we receive)\n    this.peers[instanceId] = {\n      candidateCache: []\n    };\n\n    // Create and initialize the new connection, then add that connection to the peers list\n    const pc = new RTCPeerConnection(this.peerConfig, this.peerOptions);\n    this.initConnection(pc, instanceId, 'offer');\n    this.peers[instanceId].connection = pc;\n\n    // Create a data channel through which messaging will take place, we'll call it \"dataChannel\"\n    // Designate who owns that channel and push it onto the peers list\n    const channel = pc.createDataChannel('dataChannel');\n    channel.owner = instanceId;\n    this.peers[instanceId].channel = channel;\n\n    // Set up all our event listeners for this channel so we can hook into them\n    this.addDataChannelListeners(channel);\n\n    // Create an SDP offer for the peer connection\n    pc.createOffer()\n      .then(offer => {\n        this.logger.log('WebRTC: Offer created');\n\n        // Set the offer as the local description\n        pc.setLocalDescription(offer)\n          .then(this.logger.log('WebRTC: Set offer as local description'))\n          .catch(\n            this._handleError(\n              'WebRTC: Error setting offer as local description'\n            )\n          );\n      })\n      .catch(this._handleError('WebRTC: Error creating offer'));\n  }\n\n  // Send an internal WebRTC message (this will always be an ICE candidate or SDP message)\n  sendInternalMessage(type, message, to) {\n    // Don't send to yourself, silly!\n    if (to !== this.instanceId) {\n      this.logger.log('WebRTC: Sending internal WebRTC message');\n\n      this.socket.send(WEBRTC_INTERNAL_MESSAGE, {\n        instanceId: this.instanceId,\n        scopeId: this.scopeId,\n        to,\n        type,\n        data: message\n      });\n    }\n  }\n\n  // Receive an internal WebRTC message (this will always be an ICE candidate or SDP message)\n  receiveInternalMessage({ type, instanceId, data }) {\n    switch (type) {\n      case 'candidate':\n        this.remoteCandidateReceived(instanceId, data);\n        break;\n      case 'offer':\n        this.remoteOfferReceived(instanceId, data);\n        break;\n      case 'answer':\n        this.remoteAnswerReceived(instanceId, data);\n        break;\n    }\n  }\n\n  // When that internal WebRTC message is an ICE candidate\n  remoteCandidateReceived(instanceId, data) {\n    this.logger.log('WebRTC: Remote candidate received');\n\n    // If the connection doesn't exist, create it first\n    if (this.peers[instanceId] === undefined) {\n      this.createConnection(instanceId);\n    }\n\n    // Get the peer connection of that user and add the ICE candidate to their list\n    const pc = this.peers[instanceId].connection;\n\n    pc.addIceCandidate(new RTCIceCandidate(data))\n      .then(this.logger.log('WebRTC: Adding ICE candidate to peer connection'))\n      .catch(\n        this._handleError(\n          'WebRTC: Error adding ICE candidate to peer connection'\n        )\n      );\n  }\n\n  // When that internal WebRTC message is an SDP offer\n  remoteOfferReceived(instanceId, data) {\n    this.logger.log('WebRTC: Remote offer received');\n\n    // If the connection doesn't exist, create it first\n    if (this.peers[instanceId] === undefined) {\n      this.createConnection(instanceId);\n    }\n\n    // Get the peer connection of that user\n    const pc = this.peers[instanceId].connection;\n\n    // Set the remote description to be the SDP offer\n    pc.setRemoteDescription(new RTCSessionDescription(data))\n      .then(() => {\n        this.logger.log('WebRTC: Setting offer as remote description');\n\n        // Create an SDP answer in response to their SDP offer\n        pc.createAnswer()\n          .then(answer => {\n            this.logger.log('WebRTC: Answer created');\n\n            // Set this answer as the peer's local description\n            pc.setLocalDescription(answer)\n              .then(this.logger.log('WebRTC: Set answer as local description'))\n              .catch(\n                this._handleError(\n                  'WebRTC: Error setting answer as local description'\n                )\n              );\n          })\n          .catch(this._handleError('WebRTC: Error creating answer'));\n      })\n      .catch(\n        this._handleError('WebRTC: Error setting offer as remote description')\n      );\n  }\n\n  // When that internal WebRTC message is an SDP answer\n  remoteAnswerReceived(instanceId, data) {\n    this.logger.log('WebRTC: Remote answer received');\n\n    // Get the peer connection of that user and set the remote description to be the SDP offer\n    const pc = this.peers[instanceId].connection;\n\n    pc.setRemoteDescription(new RTCSessionDescription(data))\n      .then(this.logger.log('WebRTC: Setting answer as remote description'))\n      .catch(\n        this._handleError('WebRTC: Error setting answer as remote description')\n      );\n  }\n\n  // This is used to attach generic logging handlers for data channels.\n  addDataChannelListeners(channel) {\n    // When the data channel is opened\n    channel.onopen = event => {\n      this.logger.log('WebRTC: Data channel open', event);\n    };\n\n    // When the data channel is closed\n    channel.onclose = event => {\n      this.logger.log('WebRTC: Data channel close', event);\n    };\n\n    // When the data channel receives a new message\n    channel.onmessage = event => {\n      this.logger.log('WebRTC: Data channel message', event);\n    };\n\n    // When the data channel errors\n    channel.onerror = err => {\n      this.logger.log('WebRTC: Data channel error', err);\n    };\n  }\n\n  // Generic error handler to just log a message\n  _handleError(message) {\n    const self = this;\n\n    return error => {\n      self.logger.log(message, error);\n    };\n  }\n\n  // Generic for each helper for looping through peers\n  _forEachPeer(callback, includeMe = false) {\n    const peers = this.peers;\n\n    // If we don't want to be in the peer list, remove ourselves\n    if (!includeMe) {\n      delete peers[this.instanceId];\n    }\n\n    for (let peer in peers) {\n      callback(peers[peer], peer);\n    }\n  }\n}\n","export default class Range {\n  constructor(start, end, step) {\n    this.start = start;\n    this.end = end;\n    this.step = step;\n\n    // TODO: Fill out range further\n    // Keep in mind, we don't want to generate the range in memory because that's exactly what makes Python ranges so efficient\n  }\n}\n","export default class Slice {\n  constructor(start, end, step = null) {\n    this.start = start;\n    this.end = end;\n    this.step = step;\n\n    // TODO: Fill out slice further\n    // Keep in mind, we don't want to generate the slice in memory because that's exactly what makes Python ranges so efficient\n  }\n}\n","// Although `Symbol` is widely supported these days, we can safely fall\n// back to using a non-enumerable string property without violating any\n// assumptions elsewhere in the implementation.\nvar useSymbol =\n  typeof Symbol === \"function\" &&\n  typeof Symbol.for === \"function\";\n\n// Used to mark `tuple.prototype` so that all objects that inherit from\n// any `tuple.prototype` object (there could be more than one) will test\n// positive according to `tuple.isTuple`.\nvar brand = useSymbol\n  ? Symbol.for(\"immutable-tuple\")\n  : \"@@__IMMUTABLE_TUPLE__@@\";\n\n// Used to save a reference to the globally shared `UniversalWeakMap` that\n// stores all known `tuple` objects.\nvar globalKey = useSymbol\n  ? Symbol.for(\"immutable-tuple-root\")\n  : \"@@__IMMUTABLE_TUPLE_ROOT__@@\";\n\n// Convenient helper for defining hidden immutable properties.\nfunction def(obj, name, value, enumerable) {\n  Object.defineProperty(obj, name, {\n    value: value,\n    enumerable: !! enumerable,\n    writable: false,\n    configurable: false\n  });\n  return value;\n}\n\nvar freeze = Object.freeze || function (obj) {\n  return obj;\n};\n\nfunction isObjRef(value) {\n  switch (typeof value) {\n  case \"object\":\n    if (value === null) {\n      return false;\n    }\n  case \"function\":\n    return true;\n  default:\n    return false;\n  }\n}\n\n// The `mustConvertThisToArray` value is true when the corresponding\n// `Array` method does not attempt to modify `this`, which means we can\n// pass a `tuple` object as `this` without first converting it to an\n// `Array`.\nfunction forEachArrayMethod(fn) {\n  function call(name, mustConvertThisToArray) {\n    var desc = Object.getOwnPropertyDescriptor(Array.prototype, name);\n    fn(name, desc, !! mustConvertThisToArray);\n  }\n\n  call(\"every\");\n  call(\"filter\");\n  call(\"find\");\n  call(\"findIndex\");\n  call(\"forEach\");\n  call(\"includes\");\n  call(\"indexOf\");\n  call(\"join\");\n  call(\"lastIndexOf\");\n  call(\"map\");\n  call(\"reduce\");\n  call(\"reduceRight\");\n  call(\"slice\");\n  call(\"some\");\n  call(\"toLocaleString\");\n  call(\"toString\");\n\n  // The `reverse` and `sort` methods are usually destructive, but for\n  // `tuple` objects they return a new `tuple` object that has been\n  // appropriately reversed/sorted.\n  call(\"reverse\", true);\n  call(\"sort\", true);\n\n  // Make `[...someTuple]` work.\n  call(useSymbol && Symbol.iterator || \"@@iterator\");\n}\n\n// A map data structure that holds object keys weakly, yet can also hold\n// non-object keys, unlike the native `WeakMap`.\nvar UniversalWeakMap = function UniversalWeakMap() {\n  // Since a `WeakMap` cannot hold primitive values as keys, we need a\n  // backup `Map` instance to hold primitive keys. Both `this._weakMap`\n  // and `this._strongMap` are lazily initialized.\n  this._weakMap = null;\n  this._strongMap = null;\n  this.data = null;\n};\n\n// Since `get` and `set` are the only methods used, that's all I've\n// implemented here.\n\nUniversalWeakMap.prototype.get = function get (key) {\n  var map = this._getMap(key, false);\n  if (map) {\n    return map.get(key);\n  }\n};\n\nUniversalWeakMap.prototype.set = function set (key, value) {\n  this._getMap(key, true).set(key, value);\n  // An actual `Map` or `WeakMap` would return `this` here, but\n  // returning the `value` is more convenient for the `tuple`\n  // implementation.\n  return value;\n};\n\nUniversalWeakMap.prototype._getMap = function _getMap (key, canCreate) {\n  if (! canCreate) {\n    return isObjRef(key) ? this._weakMap : this._strongMap;\n  }\n  if (isObjRef(key)) {\n    return this._weakMap || (this._weakMap = new WeakMap);\n  }\n  return this._strongMap || (this._strongMap = new Map);\n};\n\n// See [`universal-weak-map.js`](universal-weak-map.html).\n// See [`util.js`](util.html).\n// If this package is installed multiple times, there could be mutiple\n// implementations of the `tuple` function with distinct `tuple.prototype`\n// objects, but the shared pool of `tuple` objects must be the same across\n// all implementations. While it would be ideal to use the `global`\n// object, there's no reliable way to get the global object across all JS\n// environments without using the `Function` constructor, so instead we\n// use the global `Array` constructor as a shared namespace.\nvar root = Array[globalKey] || def(Array, globalKey, new UniversalWeakMap, false);\n\nfunction lookup() {\n  return lookupArray(arguments);\n}\n\nfunction lookupArray(array) {\n  var node = root;\n\n  // Because we are building a tree of *weak* maps, the tree will not\n  // prevent objects in tuples from being garbage collected, since the\n  // tree itself will be pruned over time when the corresponding `tuple`\n  // objects become unreachable. In addition to internalization, this\n  // property is a key advantage of the `immutable-tuple` package.\n  var len = array.length;\n  for (var i = 0; i < len; ++i) {\n    var item = array[i];\n    node = node.get(item) || node.set(item, new UniversalWeakMap);\n  }\n\n  // Return node.data rather than node itself to prevent tampering with\n  // the UniversalWeakMap tree.\n  return node.data || (node.data = Object.create(null));\n}\n\n// See [`lookup.js`](lookup.html).\n// See [`util.js`](util.html).\n// When called with any number of arguments, this function returns an\n// object that inherits from `tuple.prototype` and is guaranteed to be\n// `===` any other `tuple` object that has exactly the same items. In\n// computer science jargon, `tuple` instances are \"internalized\" or just\n// \"interned,\" which allows for constant-time equality checking, and makes\n// it possible for tuple objects to be used as `Map` or `WeakMap` keys, or\n// stored in a `Set`.\nfunction tuple() {\n  var arguments$1 = arguments;\n\n  var node = lookup.apply(null, arguments);\n\n  if (node.tuple) {\n    return node.tuple;\n  }\n\n  var t = Object.create(tuple.prototype);\n\n  // Define immutable items with numeric indexes, and permanently fix the\n  // `.length` property.\n  var argc = arguments.length;\n  for (var i = 0; i < argc; ++i) {\n    t[i] = arguments$1[i];\n  }\n\n  def(t, \"length\", argc, false);\n\n  // Remember this new `tuple` object so that we can return the same object\n  // earlier next time.\n  return freeze(node.tuple = t);\n}\n\n// Since the `immutable-tuple` package could be installed multiple times\n// in an application, there is no guarantee that the `tuple` constructor\n// or `tuple.prototype` will be unique, so `value instanceof tuple` is\n// unreliable. Instead, to test if a value is a tuple, you should use\n// `tuple.isTuple(value)`.\ndef(tuple.prototype, brand, true, false);\nfunction isTuple(that) {\n  return !! (that && that[brand] === true);\n}\n\ntuple.isTuple = isTuple;\n\nfunction toArray(tuple) {\n  var array = [];\n  var i = tuple.length;\n  while (i--) { array[i] = tuple[i]; }\n  return array;\n}\n\n// Copy all generic non-destructive Array methods to `tuple.prototype`.\n// This works because (for example) `Array.prototype.slice` can be invoked\n// against any `Array`-like object.\nforEachArrayMethod(function (name, desc, mustConvertThisToArray) {\n  var method = desc && desc.value;\n  if (typeof method === \"function\") {\n    desc.value = function () {\n      var args = [], len = arguments.length;\n      while ( len-- ) args[ len ] = arguments[ len ];\n\n      var result = method.apply(\n        mustConvertThisToArray ? toArray(this) : this,\n        args\n      );\n      // Of course, `tuple.prototype.slice` should return a `tuple` object,\n      // not a new `Array`.\n      return Array.isArray(result) ? tuple.apply(void 0, result) : result;\n    };\n    Object.defineProperty(tuple.prototype, name, desc);\n  }\n});\n\n// Like `Array.prototype.concat`, except for the extra effort required to\n// convert any tuple arguments to arrays, so that\n// ```\n// tuple(1).concat(tuple(2), 3) === tuple(1, 2, 3)\n// ```\nvar ref = Array.prototype;\nvar concat = ref.concat;\ntuple.prototype.concat = function () {\n  var args = [], len = arguments.length;\n  while ( len-- ) args[ len ] = arguments[ len ];\n\n  return tuple.apply(void 0, concat.apply(toArray(this), args.map(\n    function (item) { return isTuple(item) ? toArray(item) : item; }\n  )));\n};\n\nexport default tuple;\nexport { tuple, lookup, lookupArray };\n","// This needs to map to a TensorFlow tensors\n// Needs to have its own type\n// Add other metadata\n// Need to recursively parse all entries of 'd'\n// Create a new class called TorchTensor\n// Inside of TorchTensor have a ._data (private method) which stores the information in the tensor as a TensorFlow tensor\n// IMPORTANT: This whole class should be written as a way to translate Torch tensors and commands to TensorFlow, otherwise if we receive a TensorFlow tensor, just pass it right through... no need to translate!\n\n// Consider potentially renaming TorchTensor to TensorFlowTensor since we don't have access to Torch in Javascript\n\nexport default class TorchTensor {\n  constructor(id, bin, chain, gradChain, tags, description) {\n    this.id = id;\n    this.bin = bin;\n    this.chain = chain;\n    this.gradChain = gradChain;\n    this.tags = tags;\n    this.description = description;\n  }\n}\n","export default class TorchSize {\n  constructor(size) {\n    this.size = size;\n  }\n}\n","export default class Plan {\n  constructor(operations, id, args, results, name, tags, description, isBuilt) {\n    this.operations = operations;\n    this.id = id;\n    this.args = args;\n    this.results = results;\n    this.name = name;\n    this.tags = tags;\n    this.description = description;\n    this.isBuilt = isBuilt;\n  }\n}\n","// Create a class to represent pointer tensors\n// Add all the attributes that are serialized, just as for range and slice\n\nexport default class PointerTensor {\n  constructor(\n    id,\n    idAtLocation,\n    locationId,\n    pointToAttr,\n    shape,\n    garbageCollectData\n  ) {\n    this.id = id;\n    this.idAtLocation = idAtLocation;\n    this.locationId = locationId;\n    this.pointToAttr = pointToAttr;\n    this.shape = shape;\n    this.garbageCollectData = garbageCollectData;\n  }\n}\n","export default class Message {\n  constructor(type, contents) {\n    this.type = type;\n    this.contents = contents;\n  }\n}\n","export const getArgs = func =>\n  func\n    .toString()\n    .replace(/\\/\\*[\\s\\S]*?\\*\\/|([^\\\\:]|^)\\/\\/.*$/gm, '') // Remove all comments\n    .replace(/\\r?\\n|\\r/, '') // Remove all new lines\n    .match(/function\\s.*?\\(([^)]*)\\)/)[1] // Match the function params and get the 1st group\n    .split(',') // Split the group by a \",\"\n    .map(arg => arg.replace(/\\/\\*.*\\*\\//, '').trim()) // Map the results\n    .filter(arg => arg); // Don't allow for null values!\n","/*\n  TODO: Let's look at optimization potentials by using Map() (with the key being the instanceof class) for the SIMPLIFIERS and DETAILERS variables\n*/\n\n// Import our types\nimport Range from './custom-types/range';\nimport Slice from './custom-types/slice';\nimport Tuple from 'immutable-tuple';\nimport TorchTensor from './custom-types/torch-tensor';\nimport TorchSize from './custom-types/torch-size';\nimport Plan from './custom-types/plan';\nimport PointerTensor from './custom-types/pointer-tensor';\nimport Message from './custom-types/message';\n\n// Import our helpers\nimport { getArgs } from './_helpers';\n\n// Import our errors\nimport { NO_DETAILER } from './_errors';\n\n// These are the replace functions we will run to convert Javascript to Python\nexport const SIMPLIFY_REPLACERS = [\n  [/null/g, 'None'], // Convert all nulls to Nones\n  [/false/g, 'False'], // Convert all false to False\n  [/true/g, 'True'] // Convert all true to True\n];\n\n// These are the replace functions we will run to convert Python to Javascript\nexport const DETAIL_REPLACERS = [\n  [/\\(/g, '['], // Convert all Python tuples into a Javascript Array\n  [/\\)/g, ']'],\n  [/b'/g, \"'\"], // Convert all undefined 'b' functions everywhere, remove them\n  [/'/g, '\"'], // Convert all single quotes to double quotes so JSON can parse correctly\n  [/None/g, null], // Convert all Nones to nulls\n  [/False/g, false], // Convert all False to false\n  [/True/g, true], // Convert all True to true\n  [/,]/g, ']'] // Trim all Arrays with an extra comma\n];\n\n// A simple function to run the above replacers\nexport const runReplacers = (data, replacers) => {\n  for (let i = 0; i < replacers.length; i++) {\n    data = data.replace(...replacers[i]);\n  }\n\n  return data;\n};\n\n// To simplify, we must take a Javascript object and turn it into a serialized Python string that can be interpreted by PySyft\n// This involves the following steps in order:\n// 1. Recursively parse the data\n// 2. Depending on the data type, we may run it through a simplifier function to convert that value into a string\n// 3. Run the replacers, which will convert any Javascript values into Python (null, false, true, etc.)\nexport const simplify = data => {\n  const SIMPLIFIERS = {\n    dict: d =>\n      `(0, (${Array.from(d)\n        .map(([key, value]) => `(${parse(key)}, ${parse(value)})`)\n        .join()}))`,\n    list: d => `(1, (${d.map(i => parse(i)).join()}))`,\n    range: d => `(2, (${d.start}, ${d.end}, ${d.step}))`,\n    set: d => `(3, (${[...d].map(i => parse(i)).join()}))`,\n    slice: d => `(4, (${d.start}, ${d.end}, ${d.step}))`,\n    str: d => `(5, (b'${d}'))`,\n    tuple: d => `(6, (${d.map(i => parse(i)).join()}))`,\n    torchTensor: d =>\n      `(12, (${getArgs(TorchTensor)\n        .map(i => parse(d[i]))\n        .join()}))`,\n    torchSize: d => `(13, (${d.size}))`,\n    plan: d => {\n      const args = getArgs(Plan),\n        operations = d[args[0]].map(i => parse(i)),\n        rest = args.slice(1).map(i => parse(d[i]));\n\n      return `(19, ((${operations}), ${rest.join()}))`;\n    },\n    pointerTensor: d =>\n      `(20, (${getArgs(PointerTensor)\n        .map(i => parse(d[i]))\n        .join()}))`,\n    message: d =>\n      `(24, (${getArgs(Message)\n        .map(i => parse(d[i]))\n        .join()}))`\n  };\n\n  const parse = d => {\n    if (d === null) return 'null';\n\n    let simplifierId = null;\n\n    if (d instanceof Map) simplifierId = 'dict';\n    else if (d instanceof Array) simplifierId = 'list';\n    else if (d instanceof Range) simplifierId = 'range';\n    else if (d instanceof Set) simplifierId = 'set';\n    else if (d instanceof Slice) simplifierId = 'slice';\n    else if (typeof d === 'string') simplifierId = 'str';\n    else if (d instanceof Tuple) simplifierId = 'tuple';\n    else if (d instanceof TorchTensor) simplifierId = 'torchTensor';\n    else if (d instanceof TorchSize) simplifierId = 'torchSize';\n    else if (d instanceof Plan) simplifierId = 'plan';\n    else if (d instanceof PointerTensor) simplifierId = 'pointerTensor';\n    else if (d instanceof Message) simplifierId = 'message';\n\n    if (simplifierId !== null) {\n      return SIMPLIFIERS[simplifierId](d);\n    }\n\n    return d;\n  };\n\n  return runReplacers(parse(data), SIMPLIFY_REPLACERS);\n};\n\n// To detail, we must take a Python string serialized in PySyft and turn it into a Javascript object that we can manipulate and store\n// This involves the following steps in order:\n// 1. Run the replacers, which will convert any Python values into Javascript (() => [], None, True, False, etc.)\n// 2. Parse the string as JSON\n// 3. Recursively parse the data\n// 4. Depending on the data type, we may run it through a detailer function to convert that value into the appropriate JAvascript type\nexport const detail = data => {\n  const DETAILERS = [\n    d => new Map(d.map(i => i.map(j => parse(j)))), // 0 = dict\n    d => d.map(i => parse(i)), // 1 = list\n    d => new Range(...d), // 2 = range\n    d => new Set(d.map(i => parse(i))), // 3 = set\n    d => new Slice(...d), // 4 = slice\n    d => d[0], // 5 = str\n    d => Tuple(...d.map(i => parse(i))), // 6 = tuple\n    null, // 7\n    null, // 8\n    null, // 9\n    null, // 10\n    null, // 11\n    d => new TorchTensor(...d.map(i => parse(i))), // 12 = torch-tensor\n    d => new TorchSize(d), // 13 = torch.Size\n    null, // 14\n    null, // 15\n    null, // 16\n    null, // 17\n    null,\n    d => new Plan(d[0].map(j => parse(j)), ...d.slice(1).map(i => parse(i))), // 19 = plan\n    d => new PointerTensor(...d.map(i => parse(i))), // 20 = pointer-tensor\n    null,\n    null,\n    null,\n    d => new Message(...d.map(i => parse(i))) // 24 = message\n  ];\n\n  const parse = d => {\n    if (\n      Array.isArray(d) &&\n      d.length === 2 &&\n      typeof d[0] === 'number' &&\n      Array.isArray(d[1])\n    ) {\n      const detailer = DETAILERS[d[0]];\n\n      if (detailer) {\n        return detailer(d[1]);\n      }\n\n      throw new Error(NO_DETAILER(d));\n    }\n\n    return d;\n  };\n\n  return parse(JSON.parse(runReplacers(data, DETAIL_REPLACERS)));\n};\n","export const NO_DETAILER = d =>\n  `You have passed a detailer type that may exist in PySyft, but is not currently supported in syft.js. Please file a feature request (https://github.com/OpenMined/syft.js/issues) for type ${\n    d[0]\n  }, with value: ${d[1]}.`;\n","/*\n  TODO:\n   - Figure out a better deployment script in package.json that could include other examples\n   - Figure out Redis on grid.js\n   - Figure out a way to share the constants file with grid.js\n*/\n\n// import * as tf from '@tensorflow/tfjs';\n\nimport EventObserver from './events';\nimport Logger from './logger';\nimport Socket from './sockets';\nimport WebRTCClient from './webrtc';\nimport { detail } from './serde';\n\nimport {\n  SOCKET_STATUS,\n  GET_PLANS,\n  WEBRTC_INTERNAL_MESSAGE,\n  WEBRTC_NEW_PEER,\n  WEBRTC_PEER_LEFT\n} from './_constants';\n\nexport default class syft {\n  /* ----- CONSTRUCTOR ----- */\n  constructor(opts = {}) {\n    const { url, verbose, instanceId, scopeId, protocolId, peerConfig } = opts;\n\n    // My instance ID\n    this.instanceId = instanceId || null;\n\n    // The assigned scope ID\n    this.scopeId = scopeId || null;\n\n    // The chosen protocol we are working on\n    this.protocolId = protocolId;\n\n    // Our role in the plans\n    this.role = null;\n\n    // The participants we will be working with (only for scope creators)\n    this.participants = [];\n\n    // The list of plans we will be executing\n    this.plans = [];\n\n    // For creating event listeners\n    this.observer = new EventObserver();\n\n    // For creating verbose logging should the user desire\n    this.logger = new Logger(verbose);\n\n    // Create a socket connection at this.socket\n    this.socket = null;\n    this.createSocketConnection(url);\n\n    // The WebRTC client used for P2P communication\n    this.rtc = null;\n    this.createWebRTCClient(peerConfig);\n  }\n\n  /* ----- FUNCTIONALITY ----- */\n\n  // Get the list of plans that a participant needs to participate from grid.js\n  getPlans() {\n    return this.socket.send(GET_PLANS, {\n      scopeId: this.scopeId,\n      protocolId: this.protocolId\n    });\n  }\n\n  /* ----- EVENT HANDLERS ----- */\n\n  onSocketStatus(func) {\n    this.observer.subscribe(SOCKET_STATUS, func);\n  }\n\n  /* ----- SOCKET COMMUNICATION ----- */\n\n  // To create a socket connection internally and externally\n  createSocketConnection(url) {\n    if (!url) return;\n\n    this.socket = new Socket({\n      url,\n      logger: this.logger,\n      instanceId: this.instanceId,\n      onOpen: event => this.onOpen(event),\n      onClose: event => this.onClose(event),\n      onMessage: event => this.onMessage(event)\n    });\n  }\n\n  // To close the socket connection with the grid\n  disconnectFromGrid() {\n    this.socket.stop();\n  }\n\n  // When the socket connection is opened\n  // This is the internal event listener, the external method to subscribe to is \"onSocketStatus => ({ connected: true })\"\n  onOpen(event) {\n    this.observer.broadcast(SOCKET_STATUS, {\n      connected: true,\n      event\n    });\n  }\n\n  // When the socket connection is closed\n  // This is the internal event listener, the external method to subscribe to is \"onSocketStatus => ({ connected: false })\"\n  onClose(event) {\n    this.observer.broadcast(SOCKET_STATUS, {\n      connected: false,\n      event\n    });\n  }\n\n  // When a socket message is received, parse the message, store it, and return it\n  onMessage(event) {\n    const { type, data } = event;\n\n    if (type === GET_PLANS) {\n      if (data.error) {\n        this.logger.log('There was an error getting your plans', data.error);\n\n        return data;\n      }\n\n      // Save those plans after having Serde detail them\n      this.plans = data.plans.map(plan => detail(plan));\n\n      // Save our instanceId if we don't already have it (also for the socket connection)\n      this.instanceId = data.user.instanceId;\n      this.socket.instanceId = this.instanceId;\n\n      // Save our scopeId if we don't already have it\n      this.scopeId = data.user.scopeId;\n\n      // Save our role\n      this.role = data.user.role;\n\n      // Save the other participant instanceId's\n      this.participants = data.participants;\n\n      return this.plans;\n    } else if (type === WEBRTC_INTERNAL_MESSAGE) {\n      this.rtc.receiveInternalMessage(data);\n    } else if (type === WEBRTC_NEW_PEER) {\n      this.rtc.receiveNewPeer(data);\n    } else if (type === WEBRTC_PEER_LEFT) {\n      this.rtc.removePeer(data.instanceId);\n    }\n  }\n\n  /* ----- WEBRTC ----- */\n\n  // To create a socket connection internally and externally\n  createWebRTCClient(peerConfig, peerOptions) {\n    // If we don't have a socket sever, we can't create the WebRTCClient\n    if (!this.socket) return;\n\n    // The default STUN/TURN servers to use for NAT traversal\n    if (!peerConfig) {\n      peerConfig = {\n        iceServers: [\n          {\n            urls: [\n              'stun:stun.l.google.com:19302',\n              'stun:stun1.l.google.com:19302',\n              'stun:stun2.l.google.com:19302',\n              'stun:stun3.l.google.com:19302',\n              'stun:stun4.l.google.com:19302'\n            ]\n          }\n        ]\n      };\n    }\n\n    // Some standard options for establishing peer connections\n    if (!peerOptions) {\n      peerOptions = {\n        optional: [\n          { DtlsSrtpKeyAgreement: true }, // Required for connection between Chrome and Firefox\n          { RtpDataChannels: true } // Required in Firefox to use the DataChannels API\n        ]\n      };\n    }\n\n    this.rtc = new WebRTCClient({\n      peerConfig,\n      peerOptions,\n      logger: this.logger,\n      socket: this.socket\n    });\n  }\n\n  connectToParticipants() {\n    this.rtc.start(this.instanceId, this.scopeId);\n  }\n\n  disconnectFromParticipants() {\n    this.rtc.stop();\n  }\n\n  sendToParticipants(data, to) {\n    this.rtc.sendMessage(data, to);\n  }\n}\n","export const getQueryVariable = variable => {\n  const query = window.location.search.substring(1),\n    vars = query.split('&');\n\n  for (let i = 0; i < vars.length; i++) {\n    const pair = vars[i].split('=');\n\n    if (decodeURIComponent(pair[0]) === variable) {\n      return decodeURIComponent(pair[1]);\n    }\n  }\n\n  return null;\n};\n\nexport const writeLinksToDOM = links => {\n  document.getElementById('participant-links').innerHTML = `\n    <ul>\n    ${links\n      .map(\n        (link, i) =>\n          `\n          <li>\n            <a href=\"${link}\" target=\"_blank\">Link for participant ${i + 1}</a>\n          </li>\n          `\n      )\n      .join('')}\n    </ul>\n  `;\n};\n\nexport const writeIdentityToDOM = text => {\n  document.getElementById('identity').innerHTML = text;\n};\n","/*\nThe following is a step-by-step explanation of what's going on below:\n\n1. Initiate syft.js and connect to grid.js\n2. Get the list of plans that this user is supposed to work on\n - If there is no instanceId, grid.js will generate one for us\n - If there is no scopeId, grid.js will generate a scope and make this user the creator\n - Altogether, grid.js will send back this user's information, their list of plans, and the instanceId's of the other participants\n3. Links are created whereby other participants may join\n - These links are to be shared with the other participants\n - Note that each user will need to request their list of plans from the grid... they won't have access to another user's list of plans\n4. Create a direct peer-to-peer connection with the other participants\n - This is done using WebRTC under the hood using a mesh network by which every peer has a private data connection to every other peer\n - This is an asynchronous action, meaning that peers may come and go at any point\n - The syft.js library is capable of handling connections, disconnections, and reconnections without issue\n*/\n\n// In the real world: import syft from 'syft.js';\nimport syft from '../../src';\nimport {\n  getQueryVariable,\n  writeIdentityToDOM,\n  writeLinksToDOM\n} from './_helpers';\n\nconst gridInstance = document.getElementById('grid-instance');\nconst connectButton = document.getElementById('connect');\nconst disconnectButton = document.getElementById('disconnect');\nconst appContainer = document.getElementById('app');\nconst textarea = document.getElementById('message');\nconst submitButton = document.getElementById('message-send');\n\nappContainer.style.display = 'none';\n\nconnectButton.onclick = () => {\n  appContainer.style.display = 'block';\n  gridInstance.style.display = 'none';\n  connectButton.style.display = 'none';\n\n  startSyft(gridInstance.value);\n};\n\nconst startSyft = url => {\n  const instanceId = getQueryVariable('instance_id');\n  const scopeId = getQueryVariable('scope_id');\n\n  // 1. Initiate syft.js and create socket connection\n  const mySyft = new syft({\n    verbose: true,\n    url,\n    instanceId,\n    scopeId,\n    protocolId: 'millionaire-problem'\n  });\n\n  submitButton.onclick = () => {\n    mySyft.sendToParticipants(textarea.value);\n\n    textarea.value = '';\n  };\n\n  disconnectButton.onclick = () => {\n    mySyft.disconnectFromParticipants();\n    mySyft.disconnectFromGrid();\n\n    appContainer.style.display = 'none';\n    gridInstance.style.display = 'block';\n    connectButton.style.display = 'block';\n  };\n\n  mySyft.onSocketStatus(async ({ connected }) => {\n    if (connected) {\n      // 2. Get the plans that are assigned to me\n      const plans = await mySyft.getPlans();\n\n      console.log('PLANS', plans);\n\n      // Write my identity to the screen - not required\n      writeIdentityToDOM(\n        `You are ${mySyft.role} \"${mySyft.instanceId}\" in scope \"${mySyft.scopeId}\"`\n      );\n\n      // Push the instanceId and scopeId onto the current URL if they aren't already there\n      // This isn't strictly necessary, but if a user is a creator of a scope (instead of a participant),\n      // then they won't be able to refresh and rejoin the scope they created\n      if (!instanceId && !scopeId) {\n        window.history.pushState(\n          {},\n          null,\n          `?instance_id=${mySyft.instanceId}&scope_id=${mySyft.scopeId}`\n        );\n      }\n\n      // 3. Create links for the other participants\n      writeLinksToDOM(\n        mySyft.participants.map(\n          id =>\n            `${window.location.origin +\n              window.location.pathname}?instance_id=${id}&scope_id=${\n              mySyft.scopeId\n            }`\n        )\n      );\n\n      // 4. Create a direct P2P connection with the other participants\n      mySyft.connectToParticipants();\n    }\n  });\n};\n"],"sourceRoot":""}